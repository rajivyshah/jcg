<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Parent-Child Enquiry</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
 :root {
  --green: #28a745;
  --yellow: #ffeb3b;
  --radius: 8px;
  --max-width: 600px;
  --font-size: 16px;
}


* {
  box-sizing: border-box;
}


body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  margin: 0;
  padding: 1rem;
  font-size: var(--font-size);
  background: #f5f7fa;
  color: #333;
  line-height: 1.5;
}


h1, h2 {
  text-align: center;
  margin: 0.5rem 0 1rem;
}


form {
  background: #fff;
  padding: 1.5rem 1rem;
  border-radius: var(--radius);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  max-width: var(--max-width);
  margin: 0 auto 2rem;
}


label {
  font-weight: 600;
  margin: 1rem 0 0.25rem;
  display: block;
}


input, select, textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ccc;
  border-radius: var(--radius);
  font-size: var(--font-size);
}


button {
  margin-top: 1.5rem;
  width: 100%;
  max-width: 100%;
  padding: 1rem;
  font-size: 1.25rem;
  font-weight: 700;
  background: var(--green);
  color: var(--yellow);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
}


button:hover {
  background: #1e7e34;
}


table {
  width: 100%;
  max-width: var(--max-width);
  margin: 0 auto;
  border-collapse: collapse;
  background: #fff;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}


th, td {
  padding: 0.75rem 0.5rem;
  border-bottom: 1px solid #eee;
  text-align: left;
  font-size: 0.9rem;
}


th {
  background: #f1f3f5;
}


/* === RESPONSIVE TABLE === */
@media (max-width: 768px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }


  thead tr {
    display: none;
  }


  tr {
    margin-bottom: 1rem;
    border: 1px solid #ddd;
    border-radius: var(--radius);
    padding: 0.75rem;
  }


  td {
    border: none;
    position: relative;
    padding-left: 45%;
    font-size: 0.9rem;
  }


  td::before {
    content: attr(data-label);
    position: absolute;
    left: 0.75rem;
    width: 40%;
    font-weight: 600;
    color: #555;
  }
}


</style>
</head>
<body>


<h1>Parent-Child Enquiry</h1>
<form id="custForm">
  <label>Parent Name *</label><input name="parentName" required>
  <label>Child Name *</label><input name="childName" required>


  <label>Child Date of Birth *</label>
  <input type="date" name="childDOB" id="childDOB" required>


  <label>Child Age (auto)</label>
  <input type="text" name="childAge" id="childAge" readonly>


  <label>Location *</label><input name="location" required>
  <label>Preferred Center *</label><input name="preferredCenter" required>
  <label>Mobile *</label><input type="tel" name="mobile" required
       pattern="[0-9+\s()–-]{7,}">
  <label>Parent Email</label><input type="email" name="parentEmail" placeholder="optional">
  <label>Source</label>
  <select name="source">
    <option value="">-- optional --</option>
    <option>Google</option><option>Facebook</option>
    <option>Instagram</option><option>Referral</option><option>Other</option>
  </select>
  <label>Created By</label><input name="createdBy" placeholder="optional">
  <label>Notes</label><textarea name="notes" rows="3" placeholder="optional"></textarea>
<br> <br>
  <button type="submit">Save & Sync</button>
  <p id="msg" class="error"></p>
</form>


<h2>All Records (<span id="count">0</span>)</h2>
<table id="list">
  <thead>
    <tr>
      <th>Parent</th><th>Child</th><th>DOB</th><th>Age</th><th>Location</th>
      <th>Center</th><th>Mobile</th><th>Email</th><th>Source</th>
      <th>Created By</th><th>Created At</th><th>Notes</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>


<script>
// 1.  Replace with your Google Apps Script web-app URL
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzaRHuY2OkGYP04HKqTl5JEpITnB09AReQ4svH3kcVUwqCvHT96F8IgNtLU4AGWOJabog/exec';


function toIST(dateStr) {
  if (!dateStr) return '';
  const d = new Date(dateStr);
  return new Intl.DateTimeFormat('en-GB', {
    timeZone: 'Asia/Kolkata',
    day: '2-digit', month: '2-digit', year: 'numeric'
  }).format(d);
}




const dobInput = document.getElementById('childDOB');
const ageInput = document.getElementById('childAge');
const tbody    = document.querySelector('#list tbody');


// Auto-calculate age (years + days) on date change
function calcAge(dobStr) {
  if (!dobStr) return '';
  const dob = new Date(dobStr);
  const now = new Date();
  const diffMs = now - dob;
  const yrs = Math.floor(diffMs / (365.25 * 24 * 60 * 60 * 1000));
  const remMs = diffMs - (yrs * 365.25 * 24 * 60 * 60 * 1000);
  const days = Math.floor(remMs / (24 * 60 * 60 * 1000));
  return `${yrs} yr ${days} day`;
}
dobInput.addEventListener('change', () => ageInput.value = calcAge(dobInput.value));


// Load existing rows
async function load() {
  const res = await fetch(SHEET_URL);
  const rows = await res.json();
tbody.innerHTML = '';
rows.forEach(r => {
  const tr = document.createElement('tr');


  tr.innerHTML = `
    <td data-label="Parent">${r.ParentName}</td>
    <td data-label="Child">${r.ChildName}</td>
    <td data-label="DOB">${r.ChildDOB}</td>
    <td data-label="Age">${r.ChildAge}</td>
    <td data-label="Location">${r.Location}</td>
    <td data-label="Center">${r.PreferredCenter}</td>
    <td data-label="Mobile">${r.Mobile}</td>
    <td data-label="Email">${r.ParentEmail}</td>
    <td data-label="Source">${r.Source}</td>
    <td data-label="By">${r.CreatedBy}</td>
    <td data-label="At">${r.CreatedAt}</td>
    <td data-label="Notes">${r.Notes}</td>`;


  tbody.appendChild(tr);
});


  document.getElementById('count').textContent = rows.length;
}


// Handle form submission
document.getElementById('custForm').addEventListener('submit', async e => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const data = {
    parentName:      fd.get('parentName'),
    childName:       fd.get('childName'),
    childDOB: fd.get('childDOB'),   // leave as yyyy-mm-dd
    childAge:        ageInput.value,
    location:        fd.get('location'),
    preferredCenter: fd.get('preferredCenter'),
    mobile:          fd.get('mobile'),
    parentEmail:     fd.get('parentEmail') || '',
    source:          fd.get('source') || '',
    createdBy:       fd.get('createdBy') || '',
    notes:           fd.get('notes') || '',
    createdAt:       new Date().toISOString()
  };


  const res = await fetch(SHEET_URL, {
    method: 'POST',
    body: JSON.stringify(data)
  });
  if (res.ok) {
    e.target.reset();
    ageInput.value = '';
    load();
    document.getElementById('msg').textContent = 'Saved & synced!';
    setTimeout(() => (document.getElementById('msg').textContent = ''), 2000);
  } else {
    document.getElementById('msg').textContent = 'Error – check console';
  }
});


load(); // initial load
</script>


</body>
</html>